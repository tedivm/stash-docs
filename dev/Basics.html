<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Basic Usage &mdash; Stash 0.12.1 documentation</title>
    
    <link rel="stylesheet" href="_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.12.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Stash 0.12.1 documentation" href="index.html" />
    <link rel="next" title="Groupings" href="Grouping.html" />
    <link rel="prev" title="Overview" href="Overview.html" />
  
   

  </head>
  <body>
<nav class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="visible-md visible-lg navbar-text pull-right" id="github-stars">
      <iframe src="http://ghbtns.com/github-btn.html?user=tedivm&repo=stash&type=watch&count=true&size=small"
      allowtransparency="true" frameborder="0" scrolling="0" width="110px" height="20px"></iframe>
    </div>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#toggle-main-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="
    
      index.html">Stash</a>
    </div>
    <div class="collapse navbar-collapse" id="toggle-main-nav">
      <ul class="nav navbar-nav">
          <li><a href="
      index.html">Home</a></li>
          <li><a href="https://github.com/tedivm/stash">Github</a></li>
            
              <li><a href="http://blog.tedivm.com">Blog</a></li>
            
        
      </ul>
    </div>
  </div>
</nav>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Grouping.html" title="Groupings"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="Contents.html">Stash 0.12.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="container-wrapper">
        <div class="container-fluid">
            
    <div class="top-links">
      <ul class="breadcrumb pull-right">
        <li>
          <a href="Overview.html" title="previous chapter (use the left arrow)">&larr; Overview</a>
          <span class="divider"></span>
          
        </li>
          <li><a href="Grouping.html" title="next chapter (use the right arrow)">Groupings &rarr;</a></li>
      </ul>
    </div>
  
            <div class="row document clearer">
  <div class="col-md-3 sphinxsidebar">
    <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="
      index.html">
          <img class="logo" src="_static/tedivmGlider.png" alt="Logo"/>
        </a></p>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3><a href="
    
      index.html">Table Of Contents</a></h3>
  </div>
  <div class="panel-body panel-toc panel-globaltoc">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Stash</a></li>
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#concepts">Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pools-and-items">Pools and Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drivers">Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keys">Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#namespaces">Namespaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-items">Creating Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#identifying-items">Identifying Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#caching-data">Caching Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clearing-data">Clearing Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#emptying-the-entire-cache">Emptying the Entire Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-maintenance">Running Maintenance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Grouping.html">Groupings</a></li>
<li class="toctree-l1"><a class="reference internal" href="Invalidation.html">Invalidation</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="Drivers.html">Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Integration.html">Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Extending.html">Extending</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contributing.html">Contributing</a></li>
</ul>

  </div>
</div>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Search</h3>
  </div>
  <div class="panel-body">
    <form class="form-inline" action="search.html" method="get" role="form">
      <div class="input-group">
        <input name="q" type="text" class="form-control">
        <span class="input-group-btn">
          <button class="btn btn-default" type="button">Go</button>
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
    </div>
  </div>
                <div class="col-md-9 body">
                  
  <div class="section" id="basic-usage">
<span id="basics"></span><h1>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pools-and-items">
<h3>Pools and Items<a class="headerlink" href="#pools-and-items" title="Permalink to this headline">¶</a></h3>
<p>The Pool class represents the caching system as a whole, while the Item class represents the pieces of data that are
stored in it. Item classes get pulled out of the Pool when they are needed (in other words, Pools are Item Factories).</p>
</div>
<div class="section" id="drivers">
<h3>Drivers<a class="headerlink" href="#drivers" title="Permalink to this headline">¶</a></h3>
<p>Drivers allow Stash to interact with different caching systems by abstracting away the system specific APIs.</p>
<p>For the most part Drivers are invisible. Once they're created and injected into the Pool they can be forgotten about.
If you're using Stash with a framework, such as the Symfony Stash Bundle, you can ignore drivers altogether.</p>
</div>
<div class="section" id="keys">
<h3>Keys<a class="headerlink" href="#keys" title="Permalink to this headline">¶</a></h3>
<p>Keys are unique strings that map to data in the caching system. Each Item is associated with a Key. At the simplest
level Keys can be looked at as alphanumeric strings with a one to one mapping. This works like most traditional caching
systems, with each key mapping to a single piece of data in the caching system.</p>
<p>Stash also has a special kind of grouping system that allow cache items to be nested by adding a slash to Keys (the same
syntax as identifying folders on a filesystem). These slashes tells Stash where the nesting points are. Nesting allows
developers to organize items just like they would files and folders on a computer. This makes clearing groups of items
in the cache as simple as clearing their parent node, just like deleting a directory would erase all the files underneath.</p>
<p>A project that had different models, each identified by an id and a type, might have it's keys for those models start
with models/type/id, with individual pieces of data stored in keys inside of those. If the user &quot;bob&quot; had the id &quot;32&quot;,
the path to his data in the cache would be &quot;models/users/32&quot;.</p>
</div>
<div class="section" id="namespaces">
<h3>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline">¶</a></h3>
<p>Namespaces provide a simple way of grouping cache data together and isolating it from other data in the system.
Namespaces are set on the Pool, with each subsequent Item retrieved from the Pool being a member of that Namespace. Two
Items with the same key but different Namespaces will refer to different data, and actions performed on a Pool with a
set Namespace only affects that Namespace.</p>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-items">
<h3>Creating Items<a class="headerlink" href="#creating-items" title="Permalink to this headline">¶</a></h3>
<p>Creating an Item with Stash is simple-</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stash\Pool</span><span class="p">();</span>

<span class="c1">// Set the &quot;key&quot;, which is the path the Stash object points to.</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/data&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This will create a Pool using the default &quot;Ephemeral&quot; driver. Data will be cached for the lifetime of the request, but
will not be available to future requests. In order to cache data across requests a drivers is needed.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Create Driver with default options</span>
<span class="nv">$driver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stash\Driver\FileSystem</span><span class="p">();</span>
<span class="nv">$driver</span><span class="o">-&gt;</span><span class="na">setOptions</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>

<span class="c1">// Inject the driver into a new Pool object.</span>
<span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stash\Pool</span><span class="p">(</span><span class="nv">$driver</span><span class="p">);</span>

<span class="c1">// New Items will get and store their data using the same Driver.</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/data&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Each driver object can be used by many different Pool objects, and each of those Pools will then have access to the
same data.</p>
<p>Items can be retrieved from the Pool class individually or in groups.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Create Driver with default options</span>
<span class="nv">$driver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stash\Driver\FileSystem</span><span class="p">();</span>

<span class="c1">// Create pool and inject driver</span>
<span class="nv">$pool</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stash\Pool</span><span class="p">(</span><span class="nv">$driver</span><span class="p">);</span>

<span class="c1">// Retrieve a single cache item</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/data&#39;</span><span class="p">);</span>

<span class="c1">// Retrieve an iterator containing multiple cache items</span>
<span class="nv">$items</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItemIterator</span><span class="p">(</span><span class="s1">&#39;path/to/data&#39;</span><span class="p">,</span> <span class="s1">&#39;path/to/more/data&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="identifying-items">
<h3>Identifying Items<a class="headerlink" href="#identifying-items" title="Permalink to this headline">¶</a></h3>
<p>The examples so far show how to get Items using a Key represented as a string. It is also possible to represent a Key
as an array or a series of function arguments. Each of these methods will retrieve the same Item, this is just some
syntactic sugar developers can use.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Pass the key as a string</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;models/users/&#39;</span> <span class="o">.</span> <span class="nv">$id</span> <span class="o">.</span> <span class="s1">&#39;/info&#39;</span><span class="p">);</span>

<span class="c1">// Pass the key as an array</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">));</span>

<span class="c1">// Pass the key as a series of arguments</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="caching-data">
<h3>Caching Data<a class="headerlink" href="#caching-data" title="Permalink to this headline">¶</a></h3>
<p>Storing and Retrieving Data is done through the Item class. Four functions do the bulk of the work:</p>
<ul class="simple">
<li><em>get()</em> - Returns data that was previously stored, or null if nothing stored. (Since it is possible to store null
values it is very important not to rely on a null return to check for a cache miss.)</li>
<li><em>isMiss()</em> - Returns true if no data is stored or the data is stale; returns false if fresh data is present.</li>
<li><em>lock()</em> - This is used to let other processes know that this process is generating new data.</li>
<li><em>set($data, $ttl = null)</em> - Stores the specified data for use by other requests.</li>
</ul>
<p>Using these four functions, you can create simple cache blocks -- pieces of code where you fetch data, check to see if
it's fresh, and then regenerate and store the data if it was stale or absent.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get a cache item.</span>
    <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/item&#39;</span><span class="p">);</span>

<span class="c1">// Attempt to get the data</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

<span class="c1">// Check to see if the data was a miss.</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$item</span><span class="o">-&gt;</span><span class="na">isMiss</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// Let other processes know that this one is rebuilding the data.</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">lock</span><span class="p">();</span>

    <span class="c1">// Run intensive code</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nx">codeThatTakesALongTime</span><span class="p">();</span>

    <span class="c1">// Store the expensive to generate data.</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Continue as normal.</span>
<span class="nx">useDataForStuff</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>
</div>
<p>The <em>set</em> function can take an optional &quot;expiration&quot; argument, which allows developers to set either a TTL in seconds
or an explicit expiration using a DateTime object.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get cache item.</span>
    <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/item&#39;</span><span class="p">);</span>

<span class="c1">// Using an age.</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$item</span><span class="o">-&gt;</span><span class="na">isMiss</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nx">expensiveFunction</span><span class="p">();</span>
    <span class="c1">// Cache expires in one hour.</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="mi">3600</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// Using a DateTime.</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$item</span><span class="o">-&gt;</span><span class="na">isMiss</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nx">expensiveFunction</span><span class="p">();</span>

    <span class="c1">// Cache expires January 21, 2015.</span>
    <span class="nv">$expiration</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;2015-01-21&#39;</span><span class="p">);</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$expiration</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The expiration time only sets a maximum time the Item can be considered fresh, not a minimum. Items can be
invalidated from the cache before their expiration time for a number of reasons. Stash will also attempt to
distribute cache misses to normalize system load. At no point will an Item be considered fresh after the expiration
or ttl is reached.</p>
</div>
</div>
<div class="section" id="clearing-data">
<h3>Clearing Data<a class="headerlink" href="#clearing-data" title="Permalink to this headline">¶</a></h3>
<p>Clearing data is just as simple as getting it. Note that clearing a key will clear that key <em>and any keys beneath it in
the hierarchy.</em></p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Clearing a key.</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/data/specific/123&#39;</span><span class="p">)</span>
<span class="nv">$item</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>

<span class="c1">// Clearing a key with subkeys</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getItem</span><span class="p">(</span><span class="s1">&#39;path/to/data&#39;</span><span class="p">)</span>
<span class="nv">$item</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span> <span class="c1">// clears &#39;path/to/data/*&#39; as well as &#39;path/to/data&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="emptying-the-entire-cache">
<h3>Emptying the Entire Cache<a class="headerlink" href="#emptying-the-entire-cache" title="Permalink to this headline">¶</a></h3>
<p>The Pool class can also empty the entire cache:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="running-maintenance">
<h3>Running Maintenance<a class="headerlink" href="#running-maintenance" title="Permalink to this headline">¶</a></h3>
<p>Some caching systems require maintenance actions to occur. This can include things such as removing stale data or
reindexing for improved performance.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">purge</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on the size of the cache and the specific drivers in use this can take some time, so it is best called as
part of a separate maintenance task or as part of a cron job.</p>
</div>
</div>
</div>
</div>


                </div>
              <div class="clearfix"></div>
            </div>
            
    <div class="footer-links">
      <ul class="breadcrumb pull-right">
        <li>
          <a href="Overview.html" title="previous chapter (use the left arrow)">&larr; Overview</a>
          <span class="divider"></span>
          
        </li>
          <li><a href="Grouping.html" title="next chapter (use the right arrow)">Groupings &rarr;</a></li>
      </ul>
    </div>
  

        </div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Grouping.html" title="Groupings"
             >next</a> |</li>
        <li class="right" >
          <a href="Overview.html" title="Overview"
             >previous</a> |</li>
        <li><a href="Contents.html">Stash 0.12.1 documentation</a> &raquo;</li> 
      </ul>
    </div>

  <script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer container">
    &copy; Copyright 2014, Robert Hafner. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-29779027-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>